{"version":3,"sources":["App.js","serviceWorker.js","index.js"],"names":["DEFAULT_SOURCE","process","REACT_APP_DEFAULT_SOURCE","DEFAULT_FREQUENCY","parseInt","REACT_APP_DEFAULT_FREQUENCY","DEFAULT_FREQUENCY_UNIT","REACT_APP_DEFAULT_FREQUENCY_UNIT","searchParams","URLSearchParams","window","location","search","defaultSource","get","URL","ex","msg","concat","toString","alert","Error","defaultFrequency","defaultFrequencyUnit","App","state","source","frequency","frequencyUnit","loading","result","lastResult","lastresult","localStorage","getItem","JSON","parse","getLastResultFromLocalStorage","lookups","serverError","getSeconds","seconds","_this","loop","_callee","regenerator_default","a","wrap","_context","prev","next","dismounted","abrupt","fetch","setState","start","Date","getTime","setTimeout","stop","this","_callee2","url","response","json","_context2","aggs","products","filter","match_all","source.product","terms","field","size","source.product_count","cardinality","sort","download.date","highlight","fields","target.channel","target.version","target.locale","target.platform","build.id","ky","post","href","sent","ok","setItem","stringify","timestamp","t0","console","warn","_this2","react_default","createElement","className","ShowServerError","error","App_ShowAggregates","aggregates","aggregations","App_ShowProgressBar","ShowLookups","style","textAlign","onClick","_ref3","Object","asyncToGenerator","mark","_callee4","event","_context4","preventDefault","_x","apply","arguments","action","type","name","defaultValue","placeholder","DisplayVersion","Component","React","memo","element","document","querySelector","data","assign","dataset","target","rel","commit","title","date","slice","_ref4","isResponseError","Response","status","_ref5","toLocaleString","ShowProgressBar","secondsLeft","percentage","_this3$props","_this3","props","total","done","Math","ceil","width","id","hours","trunc","minutes","showSecondsHuman","PureComponent","ShowAggregates","previous","_this4","initial","prevProps","nanoEqual","_this$props","packageProducts","buckets","map","bucket","key","count","doc_count","previousProducts","initialProducts","topMargin","innerHeight","lastProducts","lastResultTime","margin","ShowProducts","extraClassname","lib_default","_ref6","_ref6$extraClassname","product","Boolean","hostname","match","ReactDOM","render","src_App_0","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.9697b7d3.chunk.js","sourcesContent":["import React, { Component } from \"react\";\nimport ky from \"ky\";\nimport nanoEqual from \"nano-equal\";\nimport TimeAgo from \"react-timeago\";\nimport \"./App.scss\";\n\nconst DEFAULT_SOURCE =\n  process.env.REACT_APP_DEFAULT_SOURCE || \"https://buildhub2.stage.mozaws.net/\";\nconst DEFAULT_FREQUENCY = parseInt(\n  process.env.REACT_APP_DEFAULT_FREQUENCY || 10,\n  10\n);\nconst DEFAULT_FREQUENCY_UNIT =\n  process.env.REACT_APP_DEFAULT_FREQUENCY_UNIT || \"minutes\";\n\nconst searchParams = new URLSearchParams(window.location.search);\nconst defaultSource = searchParams.get(\"s\") || DEFAULT_SOURCE;\ntry {\n  new URL(defaultSource);\n} catch (ex) {\n  const msg = `The URL parameter is not valid! Try harder. (${ex.toString()})`;\n  alert(msg);\n  throw new Error(msg);\n}\nconst defaultFrequency = parseInt(\n  searchParams.get(\"f\") || DEFAULT_FREQUENCY,\n  10\n);\nconst defaultFrequencyUnit = searchParams.get(\"u\") || DEFAULT_FREQUENCY_UNIT;\n\nfunction getLastResultFromLocalStorage() {\n  const lastresult = window.localStorage.getItem(\"lastresult\");\n  if (lastresult) {\n    return JSON.parse(lastresult);\n  }\n  return null;\n}\n\nclass App extends Component {\n  state = {\n    source: defaultSource,\n    frequency: defaultFrequency,\n    frequencyUnit: defaultFrequencyUnit,\n    loading: true,\n    result: null,\n    lastResult: getLastResultFromLocalStorage(),\n    lookups: 0,\n    serverError: null\n  };\n  async componentDidMount() {\n    this.loop();\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  getSeconds = () => {\n    let seconds = this.state.frequency;\n    if (this.state.frequencyUnit === \"minutes\") {\n      seconds *= 60;\n    } else if (this.state.frequencyUnit === \"hours\") {\n      seconds *= 60 * 60;\n    }\n    return seconds;\n  };\n\n  loop = async () => {\n    if (this.dismounted) return;\n    await this.fetch();\n    const seconds = this.getSeconds();\n    this.setState({ start: new Date().getTime() });\n    window.setTimeout(this.loop, seconds * 1000);\n  };\n\n  fetch = async () => {\n    const url = new URL(\"/api/search\", this.state.source);\n\n    const search = {\n      aggs: {\n        products: {\n          filter: { match_all: {} },\n          aggs: {\n            \"source.product\": { terms: { field: \"source.product\", size: 50 } },\n            \"source.product_count\": { cardinality: { field: \"source.product\" } }\n          }\n        }\n      },\n      size: 0,\n      sort: [{ \"download.date\": \"desc\" }],\n      highlight: {\n        fields: {\n          \"source.product\": {},\n          \"target.channel\": {},\n          \"target.version\": {},\n          \"target.locale\": {},\n          \"target.platform\": {},\n          \"build.id\": {}\n        }\n      }\n    };\n    try {\n      const response = await ky.post(url.href, { json: search });\n      if (response.ok) {\n        const json = await response.json();\n        this.setState(\n          {\n            result: json,\n            lookups: this.state.lookups + 1,\n            serverError: null\n          },\n          () => {\n            window.localStorage.setItem(\n              \"lastresult\",\n              JSON.stringify({\n                result: this.state.result,\n                timestamp: new Date().getTime()\n              })\n            );\n          }\n        );\n      } else {\n        this.setState({\n          serverError: response,\n          lookups: this.state.lookups + 1\n        });\n      }\n    } catch (ex) {\n      console.warn(\"EXCEPTION:\", ex);\n      this.setState({\n        serverError: ex,\n        lookups: this.state.lookups + 1\n      });\n    }\n  };\n\n  render() {\n    return (\n      <div>\n        <section className=\"section\">\n          <div className=\"container\">\n            <header className=\"header\">\n              <h1 className=\"title is-3\">Fresh Off The Build</h1>\n              <p className=\"subtitle is-6\">\n                What's Most Recently Built in Mozilla TaskCluster.\n                <br />\n                Basically, keeping an eye on fresh data in Buildhub.\n              </p>\n            </header>\n            {this.state.serverError && (\n              <ShowServerError error={this.state.serverError} />\n            )}\n\n            {this.state.result && (\n              <ShowAggregates\n                aggregates={this.state.result.aggregations}\n                lastResult={this.state.lastResult}\n              />\n            )}\n\n            {this.state.start && (\n              <ShowProgressBar\n                seconds={this.getSeconds()}\n                start={this.state.start}\n              />\n            )}\n\n            {this.state.lookups > 0 ? (\n              <ShowLookups lookups={this.state.lookups} />\n            ) : (\n              <p style={{ textAlign: \"center\" }}>\n                <i>Lookups haven't start yet.</i>\n              </p>\n            )}\n            {this.state.start && (\n              <button\n                className=\"button is-small\"\n                onClick={async event => {\n                  event.preventDefault();\n                  this.setState({ start: new Date().getTime() });\n                  await this.fetch();\n                }}\n              >\n                Force Refresh Now\n              </button>\n            )}\n            <hr />\n            <form action=\".\">\n              <div className=\"field is-horizontal\">\n                <div className=\"field-label is-normal\">\n                  <label className=\"label\">Source</label>\n                </div>\n                <div className=\"field-body\">\n                  <div className=\"field\">\n                    <div className=\"control\">\n                      <input\n                        className=\"input\"\n                        type=\"url\"\n                        name=\"s\"\n                        defaultValue={this.state.source}\n                        placeholder={`Source URL e.g. ${DEFAULT_SOURCE}`}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"field is-horizontal\">\n                <div className=\"field-label is-normal\">\n                  <label className=\"label\">Update Frequency</label>\n                </div>\n\n                <div className=\"field-body\">\n                  <div className=\"field\">\n                    <div className=\"field has-addons\">\n                      <div className=\"control\">\n                        <input\n                          className=\"input\"\n                          type=\"number\"\n                          name=\"f\"\n                          defaultValue={this.state.frequency}\n                          placeholder={`Number of seconds between checks. E.g. ${DEFAULT_FREQUENCY}`}\n                        />{\" \"}\n                      </div>\n                      <p className=\"control\">\n                        <span className=\"select\">\n                          <select\n                            name=\"u\"\n                            defaultValue={this.state.frequencyUnit}\n                          >\n                            <option>seconds</option>\n                            <option>minutes</option>\n                            <option>hours</option>\n                          </select>\n                        </span>\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div className=\"field is-horizontal\">\n                <div className=\"field-label\">\n                  {/* Left empty for spacing  */}\n                </div>\n                <div className=\"field-body\">\n                  <div className=\"control\">\n                    <button className=\"button is-primary\">\n                      Change Options\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </form>\n          </div>\n        </section>\n        <footer className=\"footer\">\n          <div className=\"content has-text-centered is-small\">\n            <DisplayVersion />\n          </div>\n        </footer>\n      </div>\n    );\n  }\n}\n\nexport default App;\n\nconst DisplayVersion = React.memo(() => {\n  const element = document.querySelector(\"#_version\");\n  const data = Object.assign({}, element.dataset);\n  return (\n    <p className=\"version-info\">\n      <a\n        href=\"https://github.com/peterbe/chiveproxy\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n      >\n        FreshOffTheBuild\n      </a>\n      <br />\n      Version{\" \"}\n      <a\n        href={`https://github.com/peterbe/freshoffthebuild/commit/${\n          data.commit\n        }`}\n        title={data.date}\n      >\n        {data.commit.slice(0, 7)}\n      </a>{\" \"}\n      {data.date}\n    </p>\n  );\n});\n\nfunction ShowServerError({ error }) {\n  const isResponseError = error instanceof window.Response;\n  return (\n    <article className=\"message is-danger\">\n      <div className=\"message-header\">\n        <p>{isResponseError ? \"Server Error\" : \"Network Error\"}</p>\n      </div>\n      <div className=\"message-body\">\n        {isResponseError ? (\n          <p>\n            <b>{error.status}</b> on <b>{error.url}</b>\n          </p>\n        ) : (\n          <code>{error.toString()}</code>\n        )}\n      </div>\n    </article>\n  );\n}\n\nfunction ShowLookups({ lookups }) {\n  return (\n    <p>\n      <small>\n        Number of lookups made: <b>{lookups.toLocaleString()}</b>\n      </small>\n    </p>\n  );\n}\n\nclass ShowProgressBar extends React.PureComponent {\n  state = {\n    secondsLeft: 0,\n    percentage: 0\n  };\n\n  componentDidMount() {\n    this.loop();\n  }\n\n  loop = () => {\n    const { start, seconds } = this.props;\n    const finish = start + seconds * 1000;\n    const total = finish - start;\n    const now = new Date().getTime();\n    const done = now - start;\n    const secondsLeft = Math.ceil((total - done) / 1000);\n    const percentage = Math.ceil((100 * done) / total);\n    this.setState({ secondsLeft, percentage });\n    window.setTimeout(this.loop, 1000);\n  };\n\n  componentDidUpdate() {\n    const element = document.querySelector(\"#progress\");\n    element.style.width = `${this.state.percentage}%`;\n  }\n\n  render() {\n    const { secondsLeft } = this.state;\n    return (\n      <div>\n        <div id=\"progress\">\n          <b />\n          <i />\n        </div>\n        <small>\n          Time until next check: <b>{showSecondsHuman(secondsLeft)}</b>\n        </small>\n      </div>\n    );\n  }\n}\n\nfunction showSecondsHuman(seconds) {\n  if (seconds > 3600) {\n    const hours = Math.trunc(seconds / 3600);\n    return `${hours} ${hours === 1 ? \"hour\" : \"hours\"}`;\n  } else if (seconds > 60) {\n    const minutes = Math.trunc(seconds / 60);\n    return `${minutes} ${minutes === 1 ? \"minute\" : \"minutes\"}`;\n  } else {\n    return `${seconds} ${seconds === 1 ? \"second\" : \"seconds\"}`;\n  }\n}\n\nclass ShowAggregates extends React.PureComponent {\n  state = { previous: this.props.aggregates, initial: this.props.aggregates };\n\n  componentDidUpdate(prevProps) {\n    if (!nanoEqual(prevProps.aggregates, this.props.aggregates)) {\n      this.setState({ previous: prevProps.aggregates });\n    }\n  }\n  render() {\n    const { aggregates, lastResult } = this.props;\n    function packageProducts(aggs) {\n      return aggs.products[\"source.product\"].buckets.map(bucket => {\n        return { name: bucket.key, count: bucket.doc_count };\n      });\n    }\n    const products = packageProducts(aggregates);\n    let previousProducts = null;\n    let initialProducts = null;\n    if (!nanoEqual(aggregates, this.state.previous)) {\n      previousProducts = packageProducts(this.state.previous);\n      if (!nanoEqual(this.state.previous, this.state.initial)) {\n        initialProducts = packageProducts(this.state.initial);\n      }\n    }\n    let topMargin = 50;\n    if (window.innerHeight > 1000) {\n      topMargin += 200;\n    }\n    if (previousProducts) {\n      topMargin -= 50;\n      if (initialProducts) {\n        topMargin -= 50;\n      }\n    }\n\n    let lastProducts = null;\n    let lastResultTime = null;\n    if (this.props.lastResult) {\n      if (\n        !nanoEqual(aggregates, lastResult.result.aggregations) &&\n        !nanoEqual(this.state.previous, lastResult.result.aggregations) &&\n        !nanoEqual(this.state.initial, lastResult.result.aggregations)\n      ) {\n        lastResultTime = lastResult.timestamp;\n        lastProducts = packageProducts(lastResult.result.aggregations);\n      }\n    }\n\n    return (\n      <div style={{ margin: `${topMargin}px 20px` }}>\n        {previousProducts && <p>Current:</p>}\n        <ShowProducts products={products} />\n        {previousProducts && <p>Before:</p>}\n        {previousProducts && (\n          <ShowProducts products={previousProducts} extraClassname=\"before\" />\n        )}\n        {initialProducts && <p>Initial:</p>}\n        {initialProducts && (\n          <ShowProducts products={initialProducts} extraClassname=\"initial\" />\n        )}\n        {lastResultTime && (\n          <p>\n            Last time you visited (<TimeAgo date={lastResultTime} />)\n          </p>\n        )}\n        {lastProducts && (\n          <ShowProducts products={lastProducts} extraClassname=\"last\" />\n        )}\n      </div>\n    );\n  }\n}\n\nfunction ShowProducts({ products, extraClassname = \" \" }) {\n  return (\n    <nav className={`level ${extraClassname}`}>\n      {products.map(product => (\n        <div className=\"level-item has-text-centered\" key={product.name}>\n          <div>\n            <p className=\"heading\">{product.name}</p>\n            <p className=\"title\">{product.count.toLocaleString()}</p>\n          </div>\n        </div>\n      ))}\n    </nav>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.scss\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}