(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(e,t,a){e.exports=a(34)},25:function(e,t,a){},32:function(e,t,a){},34:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(15),l=a.n(s),c=(a(25),a(1)),o=a.n(c),i=a(2),u=a(4),m=a(9),d=a(6),p=a(3),h=a(5),f=a(16),E=a(7),v=a.n(E),g=a(17),b=a.n(g),w=(a(32),Object({NODE_ENV:"production",PUBLIC_URL:"/freshoffthebuild"}).REACT_APP_DEFAULT_SOURCE||"https://buildhub2.stage.mozaws.net/"),N=parseInt(Object({NODE_ENV:"production",PUBLIC_URL:"/freshoffthebuild"}).REACT_APP_DEFAULT_FREQUENCY||10,10),y=Object({NODE_ENV:"production",PUBLIC_URL:"/freshoffthebuild"}).REACT_APP_DEFAULT_FREQUENCY_UNIT||"minutes",k=new URLSearchParams(window.location.search),O=k.get("s")||w;O.startsWith("http")||(O="https://".concat(O));try{new URL(O)}catch(P){var S="The URL parameter is not valid! Try harder. (".concat(P.toString(),")");throw alert(S),new Error(S)}var U=parseInt(k.get("f")||N,10),j=k.get("u")||y;function x(e){var t="lastresult-".concat(e),a=window.localStorage.getItem(t);return a?JSON.parse(a):null}function R(e,t){var a="lastresult-".concat(t);window.localStorage.setItem(a,JSON.stringify({result:e,timestamp:(new Date).getTime()}))}if(window.localStorage.getItem("lastresult")){if(!x(O))R(JSON.parse(window.localStorage.getItem("lastresult")),O);window.localStorage.removeItem("lastresult")}var L=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={source:O,frequency:U,frequencyUnit:j,loading:!0,result:null,lastResult:x(O),lookups:0,serverError:null},a.getSeconds=function(){var e=a.state.frequency;return"minutes"===a.state.frequencyUnit?e*=60:"hours"===a.state.frequencyUnit&&(e*=3600),e},a.loop=Object(i.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.dismounted){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.fetch();case 4:t=a.getSeconds(),a.setState({start:(new Date).getTime()}),window.setTimeout(a.loop,1e3*t);case 7:case"end":return e.stop()}},e,this)})),a.fetch=Object(i.a)(o.a.mark(function e(){var t,n,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URL(a.state.source)).pathname&&"/"!==t.pathname||(t=new URL("/api/search",a.state.source)),n={aggs:{products:{filter:{match_all:{}},aggs:{"source.product":{terms:{field:"source.product",size:50}},"source.product_count":{cardinality:{field:"source.product"}}}}},size:0,sort:[{"download.date":"desc"}],highlight:{fields:{"source.product":{},"target.channel":{},"target.version":{},"target.locale":{},"target.platform":{},"build.id":{}}}},e.prev=3,e.next=6,f.a.post(t.href,{json:n});case 6:if(!(r=e.sent).ok){e.next=14;break}return e.next=10,r.json();case 10:s=e.sent,a.setState({result:s,lookups:a.state.lookups+1,serverError:null},function(){R(a.state.result,a.state.source)}),e.next=15;break;case 14:a.setState({serverError:r,lookups:a.state.lookups+1});case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.warn("EXCEPTION:",e.t0),a.setState({serverError:e.t0,lookups:a.state.lookups+1});case 21:case"end":return e.stop()}},e,this,[[3,17]])})),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=Object(i.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.loop();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("header",{className:"header"},r.a.createElement("h1",{className:"title is-3"},"Fresh Off The Build"),r.a.createElement("p",{className:"subtitle is-6"},"What's Most Recently Built in Mozilla TaskCluster.",r.a.createElement("br",null),"Basically, keeping an eye on fresh data in Buildhub.")),this.state.serverError&&r.a.createElement(_,{error:this.state.serverError}),this.state.result&&r.a.createElement(I,{aggregates:this.state.result.aggregations,lastResult:this.state.lastResult}),this.state.start&&r.a.createElement(D,{seconds:this.getSeconds(),start:this.state.start}),this.state.lookups>0?r.a.createElement(T,{lookups:this.state.lookups}):r.a.createElement("p",{style:{textAlign:"center"}},r.a.createElement("i",null,"Lookups haven't start yet.")),this.state.start&&r.a.createElement("button",{className:"button is-small",onClick:function(){var t=Object(i.a)(o.a.mark(function t(a){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),e.setState({start:(new Date).getTime()}),t.next=4,e.fetch();case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},"Force Refresh Now"),r.a.createElement("hr",null),r.a.createElement("form",{action:"."},r.a.createElement("div",{className:"field is-horizontal"},r.a.createElement("div",{className:"field-label is-normal"},r.a.createElement("label",{className:"label"},"Source")),r.a.createElement("div",{className:"field-body"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"url",name:"s",defaultValue:this.state.source,placeholder:"Source URL e.g. ".concat(w)}))))),r.a.createElement("div",{className:"field is-horizontal"},r.a.createElement("div",{className:"field-label is-normal"},r.a.createElement("label",{className:"label"},"Update Frequency")),r.a.createElement("div",{className:"field-body"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"field has-addons"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"number",name:"f",defaultValue:this.state.frequency,placeholder:"Number of seconds between checks. E.g. ".concat(N)})," "),r.a.createElement("p",{className:"control"},r.a.createElement("span",{className:"select"},r.a.createElement("select",{name:"u",defaultValue:this.state.frequencyUnit},r.a.createElement("option",null,"seconds"),r.a.createElement("option",null,"minutes"),r.a.createElement("option",null,"hours")))))))),r.a.createElement("div",{className:"field is-horizontal"},r.a.createElement("div",{className:"field-label"}),r.a.createElement("div",{className:"field-body"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{className:"button is-primary"},"Change Options"))))))),r.a.createElement("footer",{className:"footer"},r.a.createElement("div",{className:"content has-text-centered is-small"},r.a.createElement(C,null))))}}]),t}(n.Component),C=r.a.memo(function(){var e=document.querySelector("#_version"),t=Object.assign({},e.dataset);return r.a.createElement("p",{className:"version-info"},r.a.createElement("a",{href:"https://github.com/peterbe/freshoffthebuild",target:"_blank",rel:"noopener noreferrer"},"FreshOffTheBuild"),r.a.createElement("br",null),"Version"," ",r.a.createElement("a",{href:"https://github.com/peterbe/freshoffthebuild/commit/".concat(t.commit),title:t.date},t.commit.slice(0,7))," ",t.date)});function _(e){var t=e.error,a=t instanceof window.Response;return r.a.createElement("article",{className:"message is-danger"},r.a.createElement("div",{className:"message-header"},r.a.createElement("p",null,a?"Server Error":"Network Error")),r.a.createElement("div",{className:"message-body"},a?r.a.createElement("p",null,r.a.createElement("b",null,t.status)," on ",r.a.createElement("b",null,t.url)):r.a.createElement("code",null,t.toString())))}function T(e){var t=e.lookups;return r.a.createElement("p",null,r.a.createElement("small",null,"Number of lookups made: ",r.a.createElement("b",null,t.toLocaleString())))}var D=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={secondsLeft:0,percentage:0},a.loop=function(){var e=a.props,t=e.start,n=t+1e3*e.seconds-t,r=(new Date).getTime()-t,s=Math.ceil((n-r)/1e3),l=Math.ceil(100*r/n);a.setState({secondsLeft:s,percentage:l}),window.setTimeout(a.loop,1e3)},a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.loop()}},{key:"componentDidUpdate",value:function(){document.querySelector("#progress").style.width="".concat(this.state.percentage,"%")}},{key:"render",value:function(){var e=this.state.secondsLeft;return r.a.createElement("div",null,r.a.createElement("div",{id:"progress"},r.a.createElement("b",null),r.a.createElement("i",null)),r.a.createElement("small",null,"Time until next check: ",r.a.createElement("b",null,function(e){if(e>3600){var t=Math.trunc(e/3600);return"".concat(t," ").concat(1===t?"hour":"hours")}if(e>60){var a=Math.trunc(e/60);return"".concat(a," ").concat(1===a?"minute":"minutes")}return"".concat(e," ").concat(1===e?"second":"seconds")}(e))))}}]),t}(r.a.PureComponent);var I=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={previous:a.props.aggregates,initial:a.props.aggregates},a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(e){v()(e.aggregates,this.props.aggregates)||this.setState({previous:e.aggregates})}},{key:"render",value:function(){var e=this.props,t=e.aggregates,a=e.lastResult;function n(e){return e.products["source.product"].buckets.map(function(e){return{name:e.key,count:e.doc_count}})}var s=n(t),l=null,c=null;v()(t,this.state.previous)||(l=n(this.state.previous),v()(this.state.previous,this.state.initial)||(c=n(this.state.initial)));var o=50;window.innerHeight>1e3&&(o+=200),l&&(o-=50,c&&(o-=50));var i=null,u=null;return this.props.lastResult&&(v()(t,a.result.aggregations)||v()(this.state.previous,a.result.aggregations)||v()(this.state.initial,a.result.aggregations)||(u=a.timestamp,i=n(a.result.aggregations))),r.a.createElement("div",{style:{margin:"".concat(o,"px 20px")}},l&&r.a.createElement("p",null,"Current:"),r.a.createElement(A,{products:s}),l&&r.a.createElement("p",null,"Before:"),l&&r.a.createElement(A,{products:l,extraClassname:"before"}),c&&r.a.createElement("p",null,"Initial:"),c&&r.a.createElement(A,{products:c,extraClassname:"initial"}),u&&r.a.createElement("p",null,"Last time you visited (",r.a.createElement(b.a,{date:u}),")"),i&&r.a.createElement(A,{products:i,extraClassname:"last"}))}}]),t}(r.a.PureComponent);function A(e){var t=e.products,a=e.extraClassname,n=void 0===a?" ":a;return r.a.createElement("nav",{className:"level ".concat(n)},t.map(function(e){return r.a.createElement("div",{className:"level-item has-text-centered",key:e.name},r.a.createElement("div",null,r.a.createElement("p",{className:"heading"},e.name),r.a.createElement("p",{className:"title"},e.count.toLocaleString())))}))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[20,2,1]]]);
//# sourceMappingURL=main.f126a7ce.chunk.js.map