(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,t,a){e.exports=a(31)},24:function(e,t,a){},29:function(e,t,a){},31:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(15),c=a.n(s),l=(a(24),a(1)),o=a.n(l),i=a(2),u=a(4),m=a(8),d=a(6),p=a(3),h=a(5),f=a(16),E=a(10),v=a.n(E),g=(a(29),Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_DEFAULT_SOURCE||"https://buildhub2.stage.mozaws.net/"),b=parseInt(Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_DEFAULT_FREQUENCY||60,10),N=Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_DEFAULT_FREQUENCY_UNIT||"seconds",w=new URLSearchParams(window.location.search),y=w.get("s")||g;try{new URL(y)}catch(R){var k="The URL parameter is not valid! Try harder. (".concat(R.toString(),")");throw alert(k),new Error(k)}var O=parseInt(w.get("f")||b,10),U=w.get("u")||N,j=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={source:y,frequency:O,frequencyUnit:U,loading:!0,result:null,lookups:0,serverError:null},a.getSeconds=function(){var e=a.state.frequency;return"minutes"===a.state.frequencyUnit?e*=60:"hours"===a.state.frequencyUnit&&(e*=3600),e},a.loop=Object(i.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.dismounted){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.fetch();case 4:t=a.getSeconds(),a.setState({start:(new Date).getTime()}),window.setTimeout(a.loop,1e3*t);case 7:case"end":return e.stop()}},e,this)})),a.fetch=Object(i.a)(o.a.mark(function e(){var t,n,r,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URL("/api/search",a.state.source),n={aggs:{products:{filter:{match_all:{}},aggs:{"source.product":{terms:{field:"source.product",size:50}},"source.product_count":{cardinality:{field:"source.product"}}}}},size:0,sort:[{"download.date":"desc"}],highlight:{fields:{"source.product":{},"target.channel":{},"target.version":{},"target.locale":{},"target.platform":{},"build.id":{}}}},e.prev=2,e.next=5,f.a.post(t.href,{json:n});case 5:if(!(r=e.sent).ok){e.next=13;break}return e.next=9,r.json();case 9:s=e.sent,a.setState({result:s,lookups:a.state.lookups+1,serverError:null}),e.next=14;break;case 13:a.setState({serverError:r,lookups:a.state.lookups+1});case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),console.warn("EXCEPTION:",e.t0),a.setState({serverError:e.t0,lookups:a.state.lookups+1});case 20:case"end":return e.stop()}},e,this,[[2,16]])})),a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=Object(i.a)(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.loop();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.dismounted=!0}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("section",{className:"section"},r.a.createElement("div",{className:"container"},r.a.createElement("header",{className:"header"},r.a.createElement("h1",{className:"title is-3"},"Fresh Off The Build"),r.a.createElement("p",{className:"subtitle is-6"},"What's Most Recently Built in Mozilla TaskCluster.",r.a.createElement("br",null),"Basically, keeping an eye on fresh data in Buildhub.")),this.state.serverError&&r.a.createElement(S,{error:this.state.serverError}),this.state.result&&r.a.createElement(L,{aggregates:this.state.result.aggregations}),this.state.start&&r.a.createElement(C,{seconds:this.getSeconds(),start:this.state.start}),this.state.lookups>0?r.a.createElement(_,{lookups:this.state.lookups}):r.a.createElement("p",{style:{textAlign:"center"}},r.a.createElement("i",null,"Lookups haven't start yet.")),this.state.start&&r.a.createElement("button",{className:"button is-small",onClick:function(){var t=Object(i.a)(o.a.mark(function t(a){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),e.setState({start:(new Date).getTime()}),t.next=4,e.fetch();case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},"Force Refresh Now"),r.a.createElement("hr",null),r.a.createElement("form",{action:"."},r.a.createElement("div",{className:"field is-horizontal"},r.a.createElement("div",{className:"field-label is-normal"},r.a.createElement("label",{className:"label"},"Source")),r.a.createElement("div",{className:"field-body"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"url",name:"s",defaultValue:this.state.source,placeholder:"Source URL e.g. ".concat(g)}))))),r.a.createElement("div",{className:"field is-horizontal"},r.a.createElement("div",{className:"field-label is-normal"},r.a.createElement("label",{className:"label"},"Update Frequency")),r.a.createElement("div",{className:"field-body"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"field has-addons"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input",type:"number",name:"f",defaultValue:this.state.frequency,placeholder:"Number of seconds between checks. E.g. ".concat(b)})," "),r.a.createElement("p",{className:"control"},r.a.createElement("span",{className:"select"},r.a.createElement("select",{name:"u",defaultValue:this.state.frequencyUnit},r.a.createElement("option",null,"seconds"),r.a.createElement("option",null,"minutes"),r.a.createElement("option",null,"hours")))))))),r.a.createElement("div",{className:"field is-horizontal"},r.a.createElement("div",{className:"field-label"}),r.a.createElement("div",{className:"field-body"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{className:"button is-primary"},"Change Options"))))))),r.a.createElement("footer",{className:"footer"},r.a.createElement("div",{className:"content has-text-centered is-small"},r.a.createElement(x,null))))}}]),t}(n.Component),x=r.a.memo(function(){var e=document.querySelector("#_version"),t=Object.assign({},e.dataset);return r.a.createElement("p",{className:"version-info"},r.a.createElement("a",{href:"https://github.com/peterbe/chiveproxy",target:"_blank",rel:"noopener noreferrer"},"FreshOffTheBuild"),r.a.createElement("br",null),"Version"," ",r.a.createElement("a",{href:"https://github.com/peterbe/freshoffthebuild/commit/".concat(t.commit),title:t.date},t.commit.slice(0,7))," ",t.date)});function S(e){var t=e.error,a=t instanceof window.Response;return r.a.createElement("article",{className:"message is-danger"},r.a.createElement("div",{className:"message-header"},r.a.createElement("p",null,a?"Server Error":"Network Error")),r.a.createElement("div",{className:"message-body"},a?r.a.createElement("p",null,r.a.createElement("b",null,t.status)," on ",r.a.createElement("b",null,t.url)):r.a.createElement("code",null,t.toString())))}function _(e){var t=e.lookups;return r.a.createElement("p",null,r.a.createElement("small",null,"Number of lookups made: ",r.a.createElement("b",null,t.toLocaleString())))}var C=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={secondsLeft:0,percentage:0},a.loop=function(){var e=a.props,t=e.start,n=t+1e3*e.seconds-t,r=(new Date).getTime()-t,s=Math.ceil((n-r)/1e3),c=Math.ceil(100*r/n);a.setState({secondsLeft:s,percentage:c}),window.setTimeout(a.loop,1e3)},a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.loop()}},{key:"componentDidUpdate",value:function(){document.querySelector("#progress").style.width="".concat(this.state.percentage,"%")}},{key:"render",value:function(){var e=this.state.secondsLeft;return r.a.createElement("div",null,r.a.createElement("div",{id:"progress"},r.a.createElement("b",null),r.a.createElement("i",null)),r.a.createElement("small",null,"Time until next check: ",r.a.createElement("b",null,function(e){if(e>3600){var t=Math.trunc(e/3600);return"".concat(t," ").concat(1===t?"hour":"hours")}if(e>60){var a=Math.trunc(e/60);return"".concat(a," ").concat(1===a?"minute":"minutes")}return"".concat(e," ").concat(1===e?"second":"seconds")}(e))))}}]),t}(r.a.PureComponent);var L=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={previous:a.props.aggregates,initial:a.props.aggregates},a}return Object(h.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(e){v()(e.aggregates,this.props.aggregates)||this.setState({previous:e.aggregates})}},{key:"render",value:function(){var e=this.props.aggregates;function t(e){return e.products["source.product"].buckets.map(function(e){return{name:e.key,count:e.doc_count}})}var a=t(e),n=null,s=null;v()(e,this.state.previous)||(n=t(this.state.previous),v()(this.state.previous,this.state.initial)||(s=t(this.state.initial)));var c=50;return window.innerHeight>1e3&&(c+=200),n&&(c-=50,s&&(c-=50)),r.a.createElement("div",{style:{margin:"".concat(c,"px 20px")}},n&&r.a.createElement("p",null,"Current:"),r.a.createElement(T,{products:a}),n&&r.a.createElement("p",null,"Before:"),n&&r.a.createElement(T,{products:n,extraClassname:"before"}),s&&r.a.createElement("p",null,"Initial:"),s&&r.a.createElement(T,{products:s,extraClassname:"initial"}))}}]),t}(r.a.PureComponent);function T(e){var t=e.products,a=e.extraClassname,n=void 0===a?" ":a;return r.a.createElement("nav",{className:"level ".concat(n)},t.map(function(e){return r.a.createElement("div",{className:"level-item has-text-centered",key:e.name},r.a.createElement("div",null,r.a.createElement("p",{className:"heading"},e.name),r.a.createElement("p",{className:"title"},e.count.toLocaleString())))}))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[19,2,1]]]);
//# sourceMappingURL=main.b8dd29d1.chunk.js.map